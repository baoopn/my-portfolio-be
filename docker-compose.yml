services:
  my-portfolio-be:
    image: my-portfolio-be
    container_name: my-portfolio-be-container
    build: .
    restart: unless-stopped
    ports:
      - "${EXTERNAL_PORT:-8080}:8080"
    environment:
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
      - SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID}
      - SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET}
      - SPOTIFY_REFRESH_TOKEN=${SPOTIFY_REFRESH_TOKEN}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 30s
      timeout: 10s
      retries: 3

  telegram-bot:
    build: ./telegram_bot
    image: telegram-bot
    container_name: telegram-bot-container
    restart: unless-stopped
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    healthcheck:
      test: ["CMD", "pgrep", "python"]
      interval: 30s
      timeout: 10s
      retries: 3